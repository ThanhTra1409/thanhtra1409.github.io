<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Node.js: TCP server v·ªõi module `net` - Nguy·ªÖn Thanh Tr√†</title>
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë®‚Äçüíª</text></svg>">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
  <div class="overlay" id="overlay">
    <ul class="menu">
      <li><a href="/" data-i18n="home">Home</a></li>
      <li><a href="/posts/" data-i18n="blog">Blog</a></li>
      <li><a href="/about/" data-i18n="about">About</a></li>
    </ul>
  </div>
  <header>
    <nav>
      <div class="brand"><a href="/" data-i18n="site-title">Nguy·ªÖn Thanh Tr√†</a></div>
      <ul>
        <li><a href="/" data-i18n="home">Home</a></li>
        <li><a href="/posts/" data-i18n="blog">Blog</a></li>
        <li><a href="/about/" data-i18n="about">About</a></li>
        <li class="lang-toggle-wrapper">
          <div id="lang-switch" class="lang-switch" data-lang="vi">
            <div class="lang-switch-slider"></div>
            <button id="lang-vn" class="lang-btn">VN</button>
            <button id="lang-en" class="lang-btn">EN</button>
          </div>
        </li>
      </ul>
      <div class="menu-toggle" onclick="toggleMenu()" aria-label="menu">‚ò∞</div>
    </nav>
  </header>
  <main>
    <article class="post">
      <h1>Node.js: TCP server v·ªõi module `net`</h1>
      <p class="meta">2025-12-09</p>
      <div class="featured-image"><img src="https://images.unsplash.com/photo-1618401471353-b98afee0b2eb?w=800&auto=format&fit=crop" alt="Node.js: TCP server v·ªõi module `net`"></div>
      <p>Node.js v·ªõi ki·∫øn tr√∫c event-driven v√† non-blocking I/O l√† n·ªÅn t·∫£ng tuy·ªát v·ªùi ƒë·ªÉ x√¢y d·ª±ng server m·∫°ng hi·ªáu nƒÉng cao. Module <code>net</code> ƒë∆∞·ª£c t√≠ch h·ª£p s·∫µn trong Node.js, cung c·∫•p API ƒë·ªÉ t·∫°o TCP server v√† client m·ªôt c√°ch ƒë∆°n gi·∫£n.</p>
<p>Kh√°c v·ªõi m√¥ h√¨nh multithreading trong Java, Node.js s·ª≠ d·ª•ng single-threaded event loop ƒë·ªÉ x·ª≠ l√Ω h√†ng ngh√¨n k·∫øt n·ªëi ƒë·ªìng th·ªùi, gi√∫p ti·∫øt ki·ªám t√†i nguy√™n v√† d·ªÖ d√†ng scale.</p>
<img src="https://images.unsplash.com/photo-1618401471353-b98afee0b2eb?w=1200&auto=format&fit=crop" alt="Node.js TCP Server" style="max-width: 100%; height: auto; border-radius: 8px; margin: 20px 0;">
<h3>1. T·∫°o TCP Server c∆° b·∫£n</h3>
<p>```javascript<br/>const net = require('net');</p>
<p>// T·∫°o TCP server<br/>const server = net.createServer((socket) => {<br/>  console.log('Client k·∫øt n·ªëi:', socket.remoteAddress, socket.remotePort);</p>
<p>// G·ª≠i welcome message<br/>  socket.write('Ch√†o m·ª´ng ƒë·∫øn TCP Server!\n');</p>
<p>// X·ª≠ l√Ω d·ªØ li·ªáu t·ª´ client<br/>  socket.on('data', (data) => {<br/>    console.log('Nh·∫≠n t·ª´ client:', data.toString());</p>
<p>// Echo l·∫°i cho client<br/>    socket.write(<code>Echo: ${data}</code>);<br/>  });</p>
<p>// X·ª≠ l√Ω khi client ng·∫Øt k·∫øt n·ªëi<br/>  socket.on('end', () => {<br/>    console.log('Client ng·∫Øt k·∫øt n·ªëi');<br/>  });</p>
<p>// X·ª≠ l√Ω l·ªói<br/>  socket.on('error', (err) => {<br/>    console.error('L·ªói socket:', err.message);<br/>  });<br/>});</p>
<p>// L·∫Øng nghe tr√™n port 8080<br/>server.listen(8080, () => {<br/>  console.log('TCP Server ƒëang ch·∫°y tr√™n port 8080');<br/>});</p>
<p>// X·ª≠ l√Ω l·ªói server<br/>server.on('error', (err) => {<br/>  console.error('L·ªói server:', err.message);<br/>});<br/>```</p>
<h3>2. TCP Client</h3>
<p>```javascript<br/>const net = require('net');</p>
<p>// T·∫°o TCP client<br/>const client = net.createConnection({ port: 8080, host: 'localhost' }, () => {<br/>  console.log('ƒê√£ k·∫øt n·ªëi t·ªõi server');<br/>  client.write('Xin ch√†o server!');<br/>});</p>
<p>// Nh·∫≠n d·ªØ li·ªáu t·ª´ server<br/>client.on('data', (data) => {<br/>  console.log('Nh·∫≠n t·ª´ server:', data.toString());<br/>  // client.end(); // ƒê√≥ng k·∫øt n·ªëi sau khi nh·∫≠n<br/>});</p>
<p>// X·ª≠ l√Ω khi ng·∫Øt k·∫øt n·ªëi<br/>client.on('end', () => {<br/>  console.log('ƒê√£ ng·∫Øt k·∫øt n·ªëi');<br/>});</p>
<p>// X·ª≠ l√Ω l·ªói<br/>client.on('error', (err) => {<br/>  console.error('L·ªói:', err.message);<br/>});<br/>```</p>
<h3>3. Echo Server v·ªõi qu·∫£n l√Ω nhi·ªÅu client</h3>
<p>```javascript<br/>const net = require('net');</p>
<p>class EchoServer {<br/>  constructor(port) {<br/>    this.port = port;<br/>    this.clients = new Set();<br/>    this.server = null;<br/>  }</p>
<p>start() {<br/>    this.server = net.createServer((socket) => {<br/>      this.handleConnection(socket);<br/>    });</p>
<p>this.server.listen(this.port, () => {<br/>      console.log(<code>Echo Server ch·∫°y tr√™n port ${this.port}</code>);<br/>    });</p>
<p>this.server.on('error', (err) => {<br/>      console.error('Server error:', err);<br/>    });<br/>  }</p>
<p>handleConnection(socket) {<br/>    const clientId = <code>${socket.remoteAddress}:${socket.remotePort}</code>;<br/>    console.log(<code>[${clientId}] K·∫øt n·ªëi m·ªõi</code>);</p>
<p>// Th√™m client v√†o danh s√°ch<br/>    this.clients.add(socket);</p>
<p>// G·ª≠i welcome message<br/>    socket.write(<code>Ch√†o m·ª´ng! Hi·ªán c√≥ ${this.clients.size} clients online\n</code>);</p>
<p>// X·ª≠ l√Ω d·ªØ li·ªáu<br/>    socket.on('data', (data) => {<br/>      const message = data.toString().trim();<br/>      console.log(<code>[${clientId}] ${message}</code>);</p>
<p>// Echo v·ªõi timestamp<br/>      const response = <code>[${new Date().toISOString()}] Echo: ${message}\n</code>;<br/>      socket.write(response);<br/>    });</p>
<p>// X·ª≠ l√Ω ng·∫Øt k·∫øt n·ªëi<br/>    socket.on('end', () => {<br/>      console.log(<code>[${clientId}] Ng·∫Øt k·∫øt n·ªëi</code>);<br/>      this.clients.delete(socket);<br/>    });</p>
<p>// X·ª≠ l√Ω l·ªói<br/>    socket.on('error', (err) => {<br/>      console.error(<code>[${clientId}] L·ªói:</code>, err.message);<br/>      this.clients.delete(socket);<br/>    });<br/>  }</p>
<p>broadcast(message) {<br/>    const data = <code>[Broadcast] ${message}\n</code>;<br/>    for (const client of this.clients) {<br/>      client.write(data);<br/>    }<br/>  }</p>
<p>stop() {<br/>    // ƒê√≥ng t·∫•t c·∫£ k·∫øt n·ªëi<br/>    for (const client of this.clients) {<br/>      client.end();<br/>    }</p>
<p>// ƒê√≥ng server<br/>    this.server.close(() => {<br/>      console.log('Server ƒë√£ ƒë√≥ng');<br/>    });<br/>  }<br/>}</p>
<p>// S·ª≠ d·ª•ng<br/>const server = new EchoServer(8080);<br/>server.start();</p>
<p>// Broadcast message m·ªói 30 gi√¢y<br/>setInterval(() => {<br/>  server.broadcast(<code>Server uptime: ${process.uptime()}s</code>);<br/>}, 30000);<br/>```</p>
<h3>4. Chat Server</h3>
<p>```javascript<br/>const net = require('net');</p>
<p>class ChatServer {<br/>  constructor(port) {<br/>    this.port = port;<br/>    this.clients = new Map(); // Map<socket, username><br/>    this.server = null;<br/>  }</p>
<p>start() {<br/>    this.server = net.createServer((socket) => {<br/>      this.handleClient(socket);<br/>    });</p>
<p>this.server.listen(this.port, () => {<br/>      console.log(<code>Chat Server running on port ${this.port}</code>);<br/>    });<br/>  }</p>
<p>handleClient(socket) {<br/>    // Y√™u c·∫ßu username<br/>    socket.write('Nh·∫≠p username c·ªßa b·∫°n: ');</p>
<p>let username = null;</p>
<p>socket.on('data', (data) => {<br/>      const message = data.toString().trim();</p>
<p>// N·∫øu ch∆∞a c√≥ username, set username<br/>      if (!username) {<br/>        username = message;<br/>        this.clients.set(socket, username);</p>
<p>socket.write(<code>Ch√†o m·ª´ng ${username}!\n</code>);<br/>        this.broadcast(<code>${username} ƒë√£ tham gia chat\n</code>, socket);</p>
<p>console.log(<code>${username} ƒë√£ tham gia</code>);<br/>        return;<br/>      }</p>
<p>// X·ª≠ l√Ω commands<br/>      if (message.startsWith('/')) {<br/>        this.handleCommand(socket, message);<br/>        return;<br/>      }</p>
<p>// Broadcast tin nh·∫Øn<br/>      const chatMessage = <code>[${username}]: ${message}\n</code>;<br/>      console.log(chatMessage.trim());<br/>      this.broadcast(chatMessage);<br/>    });</p>
<p>socket.on('end', () => {<br/>      if (username) {<br/>        console.log(<code>${username} ƒë√£ r·ªùi ƒëi</code>);<br/>        this.broadcast(<code>${username} ƒë√£ r·ªùi chat\n</code>, socket);<br/>        this.clients.delete(socket);<br/>      }<br/>    });</p>
<p>socket.on('error', (err) => {<br/>      console.error('Socket error:', err.message);<br/>      this.clients.delete(socket);<br/>    });<br/>  }</p>
<p>handleCommand(socket, command) {<br/>    const username = this.clients.get(socket);</p>
<p>if (command === '/users') {<br/>      const userList = Array.from(this.clients.values()).join(', ');<br/>      socket.write(<code>Online users: ${userList}\n</code>);<br/>    } else if (command === '/help') {<br/>      socket.write('Commands:\n');<br/>      socket.write('/users - Xem danh s√°ch users\n');<br/>      socket.write('/help - Hi·ªÉn th·ªã tr·ª£ gi√∫p\n');<br/>      socket.write('/quit - Tho√°t chat\n');<br/>    } else if (command === '/quit') {<br/>      socket.end();<br/>    } else {<br/>      socket.write('Unknown command. Type /help for help\n');<br/>    }<br/>  }</p>
<p>broadcast(message, excludeSocket = null) {<br/>    for (const [socket, username] of this.clients) {<br/>      if (socket !== excludeSocket) {<br/>        socket.write(message);<br/>      }<br/>    }<br/>  }<br/>}</p>
<p>// Kh·ªüi ƒë·ªông server<br/>const chatServer = new ChatServer(8080);<br/>chatServer.start();<br/>```</p>
<h3>5. X·ª≠ l√Ω Buffer v√† Encoding</h3>
<p>```javascript<br/>const net = require('net');</p>
<p>const server = net.createServer((socket) => {<br/>  // Set encoding ƒë·ªÉ t·ª± ƒë·ªông chuy·ªÉn buffer sang string<br/>  socket.setEncoding('utf8');</p>
<p>socket.on('data', (data) => {<br/>    // data ƒë√£ l√† string, kh√¥ng c·∫ßn toString()<br/>    console.log('Received:', data);<br/>  });</p>
<p>// Ho·∫∑c l√†m vi·ªác tr·ª±c ti·∫øp v·ªõi Buffer<br/>  socket.on('data', (buffer) => {<br/>    // buffer l√† Buffer object<br/>    console.log('Buffer length:', buffer.length);<br/>    console.log('Hex:', buffer.toString('hex'));<br/>    console.log('UTF-8:', buffer.toString('utf8'));<br/>    console.log('Base64:', buffer.toString('base64'));<br/>  });<br/>});<br/>```</p>
<h3>6. Keep-alive v√† Timeout</h3>
<p>```javascript<br/>const server = net.createServer((socket) => {<br/>  // Set timeout 30 gi√¢y<br/>  socket.setTimeout(30000);</p>
<p>// X·ª≠ l√Ω timeout<br/>  socket.on('timeout', () => {<br/>    console.log('Socket timeout');<br/>    socket.end('Timeout - closing connection\n');<br/>  });</p>
<p>// Enable keep-alive<br/>  socket.setKeepAlive(true, 60000); // 60 seconds</p>
<p>socket.on('data', (data) => {<br/>    // Reset timeout khi c√≥ data<br/>    socket.setTimeout(30000);<br/>    // X·ª≠ l√Ω data...<br/>  });<br/>});<br/>```</p>
<h3>7. So s√°nh v·ªõi Java Thread-based Model</h3>
<p><strong>Node.js (Event-driven)</strong>:<br/>- Single-threaded event loop<br/>- Non-blocking I/O<br/>- X·ª≠ l√Ω nhi·ªÅu k·∫øt n·ªëi v·ªõi √≠t t√†i nguy√™n<br/>- Ph√π h·ª£p v·ªõi I/O-intensive applications</p>
<p><strong>Java (Thread-based)</strong>:<br/>- M·ªói connection = m·ªôt thread<br/>- Blocking I/O (tr·ª´ khi d√πng NIO)<br/>- T·ªën nhi·ªÅu t√†i nguy√™n v·ªõi nhi·ªÅu k·∫øt n·ªëi<br/>- Ph√π h·ª£p v·ªõi CPU-intensive applications</p>
<p>Module <code>net</code> c·ªßa Node.js cung c·∫•p API ƒë∆°n gi·∫£n nh∆∞ng m·∫°nh m·∫Ω ƒë·ªÉ x√¢y d·ª±ng TCP server. V·ªõi event-driven architecture, Node.js c√≥ th·ªÉ x·ª≠ l√Ω h√†ng ngh√¨n k·∫øt n·ªëi ƒë·ªìng th·ªùi m·ªôt c√°ch hi·ªáu qu·∫£, r·∫•t ph√π h·ª£p cho c√°c ·ª©ng d·ª•ng realtime nh∆∞ chat, game server, hay IoT applications.</p>
<p>Trong b√†i vi·∫øt ti·∫øp theo, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ Socket.IO - m·ªôt th∆∞ vi·ªán x√¢y d·ª±ng tr√™n WebSocket, gi√∫p vi·ªác ph√°t tri·ªÉn ·ª©ng d·ª•ng realtime tr·ªü n√™n d·ªÖ d√†ng h∆°n nhi·ªÅu.</p>
<p>---</p>
<h3>T√†i li·ªáu tham kh·∫£o</h3>
<p>- [Node.js net Module Documentation](https://nodejs.org/api/net.html)<br/>- [Node.js Stream API](https://nodejs.org/api/stream.html)<br/>- [Building TCP Server with Node.js](https://nodejs.dev/learn/the-nodejs-net-module)<br/>- [Node.js Network Programming](https://www.packtpub.com/product/nodejs-high-performance/9781785286148)</p>
    </article>
    <section class="social-section">
      <div class="social-container">
        <h2 data-i18n="social-title">X&#227; h&#7897;i</h2>
        <div class="social-grid">
          <a href="https://github.com/ThanhTra1409" target="_blank" class="social-card">
            <i class="fab fa-github social-icon"></i>
            <h3>GitHub</h3>
            <p>@nttra204</p>
          </a>
          <a href="https://www.facebook.com/nguyen.thanh.tra.970568?locale=vi_VN" target="_blank" class="social-card">
            <i class="fab fa-facebook social-icon"></i>
            <h3>Facebook</h3>
            <p>Nguy&#7877;n Thanh Tr&#224;</p>
          </a>
          <a href="https://www.instagram.com/nttra204_/?igsh=MXVlc3p1NG4zdnBidw%3D%3D&utm_source=qr" target="_blank" class="social-card">
            <i class="fab fa-instagram social-icon"></i>
            <h3>Instagram</h3>
            <p>@nttra204_</p>
          </a>
          <a href="https://www.linkedin.com/in/thanh-tra-nguyen-84a46833a" target="_blank" class="social-card">
            <i class="fab fa-linkedin social-icon"></i>
            <h3>LinkedIn</h3>
            <p>Nguy&#7877;n Thanh Tr&#224;</p>
          </a>
        </div>
      </div>
    </section>
  </main>
  <footer>
    <div class="footer-content">
      <div class="footer-brand">
        <h3 data-i18n="site-title">Nguy·ªÖn Thanh Tr√†</h3>
        <p class="footer-tagline" data-i18n="footer-tagline">Building scalable solutions with passion</p>
      </div>
      <div class="footer-contact">
        <h4 data-i18n="contact-info">Th&#244;ng tin li&#234;n h&#7879;</h4>
        <div class="contact-info-grid">
          <div class="contact-info-item">
            <i class="fas fa-envelope"></i>
            <a href="mailto:ntra140924@gmail.com">ntra140924@gmail.com</a>
          </div>
          <div class="contact-info-item">
            <i class="fas fa-phone"></i>
            <a href="tel:0941779093">0941779093</a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p><span data-i18n="footer-copyright">¬© 2025</span> <span data-i18n="site-title">Nguy·ªÖn Thanh Tr√†</span></p>
      </div>
    </div>
  </footer>
  <script src="/js/i18n.js"></script>
  <script>
  function toggleMenu(){
    document.body.classList.toggle('menu-open');
  }
  </script>
</body>
</html>