<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Multithreading v√† ServerSocket trong Java - Nguy·ªÖn Thanh Tr√†</title>
  <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üë®‚Äçüíª</text></svg>">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
  <div class="overlay" id="overlay">
    <ul class="menu">
      <li><a href="/" data-i18n="home">Home</a></li>
      <li><a href="/posts/" data-i18n="blog">Blog</a></li>
      <li><a href="/about/" data-i18n="about">About</a></li>
    </ul>
  </div>
  <header>
    <nav>
      <div class="brand"><a href="/" data-i18n="site-title">Nguy·ªÖn Thanh Tr√†</a></div>
      <ul>
        <li><a href="/" data-i18n="home">Home</a></li>
        <li><a href="/posts/" data-i18n="blog">Blog</a></li>
        <li><a href="/about/" data-i18n="about">About</a></li>
        <li class="lang-toggle-wrapper">
          <div id="lang-switch" class="lang-switch" data-lang="vi">
            <div class="lang-switch-slider"></div>
            <button id="lang-vn" class="lang-btn">VN</button>
            <button id="lang-en" class="lang-btn">EN</button>
          </div>
        </li>
      </ul>
      <div class="menu-toggle" onclick="toggleMenu()" aria-label="menu">‚ò∞</div>
    </nav>
  </header>
  <main>
    <article class="post">
      <h1>Multithreading v√† ServerSocket trong Java</h1>
      <p class="meta">2025-12-02</p>
      <div class="featured-image"><img src="https://images.unsplash.com/photo-1516116216624-53e697fedbea?w=800&auto=format&fit=crop" alt="Multithreading v√† ServerSocket trong Java"></div>
      <p>Trong b√†i tr∆∞·ªõc, ch√∫ng ta ƒë√£ t√¨m hi·ªÉu v·ªÅ Socket c∆° b·∫£n trong Java. Tuy nhi√™n, m·ªôt server ƒë∆°n gi·∫£n ch·ªâ x·ª≠ l√Ω m·ªôt client t·∫°i m·ªôt th·ªùi ƒëi·ªÉm l√† ch∆∞a ƒë·ªß cho ·ª©ng d·ª•ng th·ª±c t·∫ø. Khi c√≥ nhi·ªÅu client k·∫øt n·ªëi ƒë·ªìng th·ªùi, ch√∫ng ta c·∫ßn s·ª≠ d·ª•ng multithreading ƒë·ªÉ x·ª≠ l√Ω song song c√°c k·∫øt n·ªëi.</p>
<p>B√†i vi·∫øt n√†y s·∫Ω h∆∞·ªõng d·∫´n c√°ch x√¢y d·ª±ng server ƒëa lu·ªìng (multithreaded server) trong Java, s·ª≠ d·ª•ng Thread Pool v·ªõi <code>ExecutorService</code> ƒë·ªÉ qu·∫£n l√Ω hi·ªáu qu·∫£ c√°c k·∫øt n·ªëi client.</p>
<img src="https://images.unsplash.com/photo-1516116216624-53e697fedbea?w=1200&auto=format&fit=crop" alt="Multithreading Concept" style="max-width: 100%; height: auto; border-radius: 8px; margin: 20px 0;">
<h3>1. V·∫•n ƒë·ªÅ v·ªõi Single-Threaded Server</h3>
<p>Server ƒë∆°n lu·ªìng ch·ªâ x·ª≠ l√Ω m·ªôt client t·∫°i m·ªôt th·ªùi ƒëi·ªÉm. Khi ƒëang x·ª≠ l√Ω m·ªôt client, server kh√¥ng th·ªÉ ch·∫•p nh·∫≠n k·∫øt n·ªëi m·ªõi, d·∫´n ƒë·∫øn:</p>
<p>- Client ph·∫£i ch·ªù ƒë·ª£i l√¢u<br/>- Hi·ªáu su·∫•t th·∫•p v·ªõi nhi·ªÅu k·∫øt n·ªëi<br/>- Kh√¥ng t·∫≠n d·ª•ng ƒë∆∞·ª£c t√†i nguy√™n h·ªá th·ªëng</p>
<h3>2. Thread-Per-Connection Pattern</h3>
<p>C√°ch ƒë∆°n gi·∫£n nh·∫•t l√† t·∫°o m·ªôt thread m·ªõi cho m·ªói client k·∫øt n·ªëi:</p>
<p>```java<br/>import java.io.<em>;<br/>import java.net.</em>;</p>
<p>public class MultiThreadedServer {<br/>    public static void main(String[] args) {<br/>        try (ServerSocket serverSocket = new ServerSocket(8080)) {<br/>            System.out.println("Server ƒëang ch·∫°y tr√™n port 8080...");</p>
<p>while (true) {<br/>                // Ch·∫•p nh·∫≠n k·∫øt n·ªëi m·ªõi<br/>                Socket clientSocket = serverSocket.accept();<br/>                System.out.println("Client k·∫øt n·ªëi: " + clientSocket.getInetAddress());</p>
<p>// T·∫°o thread m·ªõi cho m·ªói client<br/>                Thread clientThread = new Thread(new ClientHandler(clientSocket));<br/>                clientThread.start();<br/>            }<br/>        } catch (IOException e) {<br/>            e.printStackTrace();<br/>        }<br/>    }<br/>}</p>
<p>class ClientHandler implements Runnable {<br/>    private Socket clientSocket;</p>
<p>public ClientHandler(Socket socket) {<br/>        this.clientSocket = socket;<br/>    }</p>
<p>@Override<br/>    public void run() {<br/>        try (BufferedReader in = new BufferedReader(<br/>                new InputStreamReader(clientSocket.getInputStream()));<br/>             PrintWriter out = new PrintWriter(<br/>                clientSocket.getOutputStream(), true)) {</p>
<p>String message;<br/>            while ((message = in.readLine()) != null) {<br/>                System.out.println("Nh·∫≠n: " + message);<br/>                out.println("Echo: " + message);</p>
<p>if ("bye".equalsIgnoreCase(message)) {<br/>                    break;<br/>                }<br/>            }<br/>        } catch (IOException e) {<br/>            e.printStackTrace();<br/>        } finally {<br/>            try {<br/>                clientSocket.close();<br/>            } catch (IOException e) {<br/>                e.printStackTrace();<br/>            }<br/>        }<br/>    }<br/>}<br/>```</p>
<h3>3. S·ª≠ d·ª•ng Thread Pool v·ªõi ExecutorService</h3>
<p>T·∫°o thread m·ªõi cho m·ªói k·∫øt n·ªëi c√≥ th·ªÉ g√¢y l√£ng ph√≠ t√†i nguy√™n khi c√≥ qu√° nhi·ªÅu client. Thread Pool gi√∫p gi·ªõi h·∫°n s·ªë l∆∞·ª£ng thread v√† t√°i s·ª≠ d·ª•ng ch√∫ng:</p>
<img src="https://images.unsplash.com/photo-1633356122544-f134324a6cee?w=1000&auto=format&fit=crop" alt="Thread Pool Architecture" style="max-width: 100%; height: auto; border-radius: 8px; margin: 20px 0;">
<p>```java<br/>import java.io.<em>;<br/>import java.net.</em>;<br/>import java.util.concurrent.*;</p>
<p>public class ThreadPoolServer {<br/>    private static final int PORT = 8080;<br/>    private static final int THREAD_POOL_SIZE = 10;</p>
<p>public static void main(String[] args) {<br/>        // T·∫°o thread pool v·ªõi 10 threads<br/>        ExecutorService executor = Executors.newFixedThreadPool(THREAD_POOL_SIZE);</p>
<p>try (ServerSocket serverSocket = new ServerSocket(PORT)) {<br/>            System.out.println("Server v·ªõi Thread Pool ƒëang ch·∫°y...");</p>
<p>while (true) {<br/>                Socket clientSocket = serverSocket.accept();<br/>                System.out.println("Client k·∫øt n·ªëi: " + clientSocket.getInetAddress());</p>
<p>// Submit task v√†o thread pool<br/>                executor.submit(new ClientHandler(clientSocket));<br/>            }<br/>        } catch (IOException e) {<br/>            e.printStackTrace();<br/>        } finally {<br/>            executor.shutdown();<br/>        }<br/>    }<br/>}<br/>```</p>
<h3>4. X·ª≠ l√Ω Exception v√† ƒê√≥ng T√†i Nguy√™n</h3>
<p>Quan tr·ªçng l√† ph·∫£i x·ª≠ l√Ω exception ƒë√∫ng c√°ch v√† ƒë·∫£m b·∫£o ƒë√≥ng t√†i nguy√™n:</p>
<p>```java<br/>class ClientHandler implements Runnable {<br/>    private Socket clientSocket;</p>
<p>public ClientHandler(Socket socket) {<br/>        this.clientSocket = socket;<br/>    }</p>
<p>@Override<br/>    public void run() {<br/>        try (Socket socket = clientSocket;<br/>             BufferedReader in = new BufferedReader(<br/>                new InputStreamReader(socket.getInputStream()));<br/>             PrintWriter out = new PrintWriter(<br/>                socket.getOutputStream(), true)) {</p>
<p>String message;<br/>            while ((message = in.readLine()) != null) {<br/>                processMessage(message, out);</p>
<p>if ("exit".equalsIgnoreCase(message)) {<br/>                    break;<br/>                }<br/>            }</p>
<p>} catch (IOException e) {<br/>            System.err.println("L·ªói x·ª≠ l√Ω client: " + e.getMessage());<br/>        }<br/>    }</p>
<p>private void processMessage(String message, PrintWriter out) {<br/>        System.out.println("X·ª≠ l√Ω: " + message);<br/>        out.println("Server nh·∫≠n: " + message);<br/>    }<br/>}<br/>```</p>
<h3>5. Graceful Shutdown</h3>
<p>Khi t·∫Øt server, c·∫ßn ƒë·∫£m b·∫£o t·∫•t c·∫£ thread ƒë√£ ho√†n th√†nh:</p>
<p>``<code>java<br/>Runtime.getRuntime().addShutdownHook(new Thread(() -> {<br/>    System.out.println("ƒêang t·∫Øt server...");<br/>    executor.shutdown();<br/>    try {<br/>        if (!executor.awaitTermination(60, TimeUnit.SECONDS)) {<br/>            executor.shutdownNow();<br/>        }<br/>    } catch (InterruptedException e) {<br/>        executor.shutdownNow();<br/>    }<br/>}));<br/></code>``</p>
<h3>6. L∆∞u √Ω v·ªÅ ƒê·ªìng B·ªô</h3>
<p>Khi nhi·ªÅu thread truy c·∫≠p shared data, c·∫ßn s·ª≠ d·ª•ng synchronization:</p>
<p>```java<br/>class ClientRegistry {<br/>    private final Set<Socket> clients = Collections.synchronizedSet(new HashSet<>());</p>
<p>public void addClient(Socket socket) {<br/>        clients.add(socket);<br/>    }</p>
<p>public void removeClient(Socket socket) {<br/>        clients.remove(socket);<br/>    }</p>
<p>public void broadcast(String message) {<br/>        synchronized (clients) {<br/>            for (Socket client : clients) {<br/>                try {<br/>                    PrintWriter out = new PrintWriter(client.getOutputStream(), true);<br/>                    out.println(message);<br/>                } catch (IOException e) {<br/>                    e.printStackTrace();<br/>                }<br/>            }<br/>        }<br/>    }<br/>}<br/>```</p>
<p>Multithreading l√† k·ªπ thu·∫≠t quan tr·ªçng ƒë·ªÉ x√¢y d·ª±ng server c√≥ kh·∫£ nƒÉng x·ª≠ l√Ω nhi·ªÅu client ƒë·ªìng th·ªùi. S·ª≠ d·ª•ng Thread Pool v·ªõi <code>ExecutorService</code> gi√∫p qu·∫£n l√Ω t√†i nguy√™n hi·ªáu qu·∫£ h∆°n so v·ªõi vi·ªác t·∫°o thread m·ªõi cho m·ªói k·∫øt n·ªëi.</p>
<p>Tuy nhi√™n, v·ªõi s·ªë l∆∞·ª£ng k·∫øt n·ªëi c·ª±c l·ªõn (h√†ng ngh√¨n), thread-based model c√≥ th·ªÉ g·∫∑p gi·ªõi h·∫°n. Trong b√†i vi·∫øt ti·∫øp theo, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ Java NIO - m·ªôt c√°ch ti·∫øp c·∫≠n non-blocking gi√∫p x·ª≠ l√Ω h√†ng ngh√¨n k·∫øt n·ªëi v·ªõi s·ªë l∆∞·ª£ng thread t·ªëi thi·ªÉu.</p>
<p>---</p>
<h3>T√†i li·ªáu tham kh·∫£o</h3>
<p>- [Java Concurrency Tutorial](https://docs.oracle.com/javase/tutorial/essential/concurrency/)<br/>- [ExecutorService Documentation](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html)<br/>- [Java Thread Pool Best Practices](https://www.baeldung.com/thread-pool-java-and-guava)<br/>- [Multithreaded Server Socket Programming](https://www.geeksforgeeks.org/multithreaded-servers-in-java/)</p>
    </article>
    <section class="social-section">
      <div class="social-container">
        <h2 data-i18n="social-title">X&#227; h&#7897;i</h2>
        <div class="social-grid">
          <a href="https://github.com/ThanhTra1409" target="_blank" class="social-card">
            <i class="fab fa-github social-icon"></i>
            <h3>GitHub</h3>
            <p>@nttra204</p>
          </a>
          <a href="https://www.facebook.com/nguyen.thanh.tra.970568?locale=vi_VN" target="_blank" class="social-card">
            <i class="fab fa-facebook social-icon"></i>
            <h3>Facebook</h3>
            <p>Nguy&#7877;n Thanh Tr&#224;</p>
          </a>
          <a href="https://www.instagram.com/nttra204_/?igsh=MXVlc3p1NG4zdnBidw%3D%3D&utm_source=qr" target="_blank" class="social-card">
            <i class="fab fa-instagram social-icon"></i>
            <h3>Instagram</h3>
            <p>@nttra204_</p>
          </a>
          <a href="https://www.linkedin.com/in/thanh-tra-nguyen-84a46833a" target="_blank" class="social-card">
            <i class="fab fa-linkedin social-icon"></i>
            <h3>LinkedIn</h3>
            <p>Nguy&#7877;n Thanh Tr&#224;</p>
          </a>
        </div>
      </div>
    </section>
  </main>
  <footer>
    <div class="footer-content">
      <div class="footer-brand">
        <h3 data-i18n="site-title">Nguy·ªÖn Thanh Tr√†</h3>
        <p class="footer-tagline" data-i18n="footer-tagline">Building scalable solutions with passion</p>
      </div>
      <div class="footer-contact">
        <h4 data-i18n="contact-info">Th&#244;ng tin li&#234;n h&#7879;</h4>
        <div class="contact-info-grid">
          <div class="contact-info-item">
            <i class="fas fa-envelope"></i>
            <a href="mailto:ntra140924@gmail.com">ntra140924@gmail.com</a>
          </div>
          <div class="contact-info-item">
            <i class="fas fa-phone"></i>
            <a href="tel:0941779093">0941779093</a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p><span data-i18n="footer-copyright">¬© 2025</span> <span data-i18n="site-title">Nguy·ªÖn Thanh Tr√†</span></p>
      </div>
    </div>
  </footer>
  <script src="/js/i18n.js"></script>
  <script>
  function toggleMenu(){
    document.body.classList.toggle('menu-open');
  }
  </script>
</body>
</html>